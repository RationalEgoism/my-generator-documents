<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes">
    <title>SA Document Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
 
 
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
        }

        .version {
            text-align: center;
            color: #666;
            font-size: 14px;
            margin-bottom: 30px;
            font-weight: normal;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #ddd;
        }

        .tab {
            padding: 15px 30px;
            background: #f5f5f5;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            border-radius: 10px 10px 0 0;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #e0e0e0;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .form-content {
            display: none;
        }

        .form-content.active {
            display: block;
        }

        .form-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
            font-size: 14px;
        }

        input, select, textarea {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border 0.3s;
            font-family: Arial, sans-serif;
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .photo-upload {
            grid-column: 1 / -1;
            text-align: center;
        }

        .photo-upload input {
            display: none;
        }

        .generate-custom-data {
            grid-column: 1 / -1;
            text-align: center;
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .generate-custom-data-btn {
            background: #667eea;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
            display: inline-block;
        }

        .generate-custom-data-btn:hover {
            background: #5568d3;
        }

        .copy-btn {
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: background 0.3s;
            margin-left: 10px;
            white-space: nowrap;
        }

        .copy-btn:hover {
            background: #218838;
        }

        .copy-btn:active {
            background: #1e7e34;
            transform: scale(0.98);
        }

        .form-group-with-copy {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group-with-copy input {
            flex: 1;
        }

        .upload-btn {
            background: #667eea;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
            display: inline-block;
        }

        .upload-btn:hover {
            background: #5568d3;
        }

        .generate-btn {
            width: 100%;
            background: #28a745;
            color: white;
            padding: 15px;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }

        .generate-btn:hover {
            background: #218838;
        }

        .download-btn {
            width: 60%;
            background: #007bff;
            color: white;
            padding: 15px;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
            margin: 20px auto;
            display: block;
        }

        .download-btn:hover {
            background: #0056b3;
        }

        .preview-photo {
            margin-top: 10px;
            max-width: 150px;
            max-height: 150px;
            display: none;
            border-radius: 5px;
            margin-left: auto;
            margin-right: auto;
        }

        .document-container {
            margin-top: 40px;
            display: none;
            overflow-x: auto;
            width: 100%;
            overflow: visible;
        }

        /* ID CARD STYLES */
        .id-card {
            width: 856px;
            height: 540px;
            background: linear-gradient(135deg, #00a651 0%, #007a3d 100%);
            border-radius: 15px;
            position: relative;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
            margin: 0 auto;
        }

        .id-card-header {
            background: rgba(255,255,255,0.95);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid #007a3d;
        }

        .coat-of-arms {
            width: 80px;
            height: 80px;
            background: #007a3d;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 10px;
            text-align: center;
            padding: 5px;
        }

        .header-text {
            flex: 1;
            text-align: center;
        }

        .header-text h2 {
            color: #007a3d;
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header-text p {
            color: #555;
            font-size: 14px;
        }

        .id-card-body {
            padding: 30px;
            display: flex;
            gap: 30px;
        }

        .photo-section {
            width: 180px;
        }

        .id-photo {
            width: 180px;
            height: 240px;
            background: white;
            border: 3px solid white;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .id-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .info-section {
            flex: 1;
            color: white;
        }

        .info-row {
            margin-bottom: 20px;
        }

        .info-label {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 3px;
        }

        .info-value {
            font-size: 18px;
            font-weight: bold;
            background: rgba(255,255,255,0.2);
            padding: 8px 12px;
            border-radius: 5px;
        }

        .id-number {
            font-size: 24px;
            letter-spacing: 2px;
        }

        .id-card-footer {
            position: absolute;
            bottom: 20px;
            left: 30px;
            right: 30px;
            display: flex;
            justify-content: space-between;
            color: white;
            font-size: 12px;
        }

        /* PASSPORT STYLES */
        .passport {
            width: 1000px;
            height: 1400px;
            background: linear-gradient(135deg, #003d82 0%, #002050 100%);
            border-radius: 10px;
            position: relative;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            margin: 0 auto;
            overflow: hidden;
        }

        .passport-cover {
            padding: 40px;
            text-align: center;
            color: gold;
        }

        .passport-coat {
            width: 150px;
            height: 150px;
            background: gold;
            border-radius: 50%;
            margin: 0 auto 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #003d82;
            font-weight: bold;
            font-size: 16px;
        }

        .passport-title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        .passport-subtitle {
            font-size: 20px;
            margin-bottom: 40px;
        }

        .passport-type {
            font-size: 28px;
            font-weight: bold;
            letter-spacing: 4px;
        }

        .passport-data-page {
            background: rgba(255,255,255,0.98);
            margin: 30px;
            padding: 30px;
            border-radius: 10px;
        }

        .passport-header-section {
            text-align: center;
            margin-bottom: 20px;
            color: #003d82;
        }

        .passport-header-section h3 {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .passport-content {
            display: flex;
            gap: 20px;
        }

        .passport-photo-section {
            width: 180px;
        }

        .passport-photo {
            width: 180px;
            height: 240px;
            background: #f0f0f0;
            border: 2px solid #003d82;
            overflow: hidden;
        }

        .passport-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .passport-info {
            flex: 1;
        }

        .passport-field {
            margin-bottom: 15px;
        }

        .passport-field-label {
            font-size: 11px;
            color: #666;
            margin-bottom: 2px;
        }

        .passport-field-value {
            font-size: 16px;
            font-weight: bold;
            color: #000;
            padding: 5px 0;
            border-bottom: 1px solid #ccc;
        }

        .passport-number {
            font-size: 20px;
            letter-spacing: 2px;
        }

        .mrz-section {
            background: #f5f5f5;
            padding: 15px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 20px;
            font-weight: bold;
            letter-spacing: 1px;
            border-radius: 5px;
        }

        /* ASYLUM PAPER STYLES */
        .asylum-paper {
            width: 800px;
            background: white;
            margin: 0 auto;
            padding: 50px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            border: 2px solid #003d82;
        }

        .asylum-header {
            text-align: center;
            border-bottom: 3px solid #003d82;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .asylum-logo {
            width: 120px;
            height: 120px;
            background: #003d82;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
            text-align: center;
            padding: 10px;
        }

        .asylum-header h2 {
            color: #003d82;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .asylum-header h3 {
            color: #666;
            font-size: 20px;
            margin-bottom: 5px;
        }

        .asylum-ref {
            text-align: center;
            background: #f0f0f0;
            padding: 15px;
            margin: 20px 0;
            border-left: 5px solid #003d82;
            font-size: 18px;
            font-weight: bold;
        }

        .asylum-content {
            display: flex;
            gap: 30px;
        }

        .asylum-photo-section {
            width: 200px;
        }

        .asylum-photo {
            width: 200px;
            height: 260px;
            background: #f0f0f0;
            border: 3px solid #003d82;
            overflow: hidden;
        }

        .asylum-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .asylum-info {
            flex: 1;
        }

        .asylum-section {
            margin-bottom: 25px;
        }

        .asylum-section h4 {
            color: #003d82;
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .asylum-field {
            margin-bottom: 15px;
        }

        .asylum-field-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 3px;
        }

        .asylum-field-value {
            font-size: 16px;
            font-weight: bold;
            color: #000;
            padding: 8px 10px;
            background: #f9f9f9;
            border-left: 3px solid #003d82;
        }

        .asylum-footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #003d82;
            display: flex;
            justify-content: space-between;
        }

        .asylum-signature {
            text-align: center;
        }

        .asylum-signature-line {
            width: 200px;
            border-bottom: 2px solid #000;
            margin-bottom: 5px;
        }

        .asylum-notice {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
        }

        .asylum-notice h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .asylum-notice p {
            color: #856404;
            font-size: 12px;
            line-height: 1.6;
        }

        @media (max-width: 900px) {
            .id-card {
                width: 100%;
                max-width: 856px;
                height: auto;
                min-height: 540px;
            }

            .passport {
                width: 100%;
                max-width: 1000px;
                height: auto;
                min-height: 1400px;
            }

            .asylum-paper {
                width: 100%;
                max-width: 800px;
            }
        }

        @media (max-width: 900px) {
            .document-container {
                display: flex;
                flex-direction: column;
                align-items: center;
                padding-bottom: 20px;
            }

            .id-card, .passport, .asylum-paper {
                display: none;
            }

            .download-btn {
                display: block;
            }
        }

        @media (max-width: 700px) {
            .id-card {
                transform: scale(0.9);
                transform-origin: top center;
                margin-bottom: 20px;
            }

            .passport {
                transform: scale(0.7);
                transform-origin: top center;
                margin-bottom: 20px;
            }

            .asylum-paper {
                transform: scale(0.85);
                transform-origin: top center;
                margin-bottom: 20px;
            }

            .container {
                padding: 15px;
            }
        }

        @media (max-width: 550px) {
            .id-card {
                transform: scale(0.7);
                transform-origin: top center;
                margin-bottom: 20px;
            }

            .passport {
                transform: scale(0.5);
                transform-origin: top center;
                margin-bottom: 20px;
            }

            .asylum-paper {
                transform: scale(0.65);
                transform-origin: top center;
                margin-bottom: 20px;
            }

            .download-btn {
                width: 90%;
                font-size: 16px;
                padding: 12px;
            }
        }

        @media (max-width: 400px) {
            .id-card {
                transform: scale(0.55);
                transform-origin: top center;
                margin-bottom: 20px;
            }

            .passport {
                transform: scale(0.35);
                transform-origin: top center;
                margin-bottom: 20px;
            }

            .asylum-paper {
                transform: scale(0.5);
                transform-origin: top center;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🇿🇦 South African Document Generator</h1>
        <div class="version">Version 1.3.1</div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('id')">ID Card</button>
            <button class="tab" onclick="switchTab('passport')">Passport</button>
            <button class="tab" onclick="switchTab('asylum')">Asylum Paper</button>
        </div>

        <!-- ID CARD FORM -->
        <div id="id-form" class="form-content active">
            <div class="form-section">
                <p>IMPORTANT: Use "Fast Registration" for quick setup with VUMA THULISILE (Female, DOB: 1999-01-16) or "Generate custom data" for random data. ID number is auto-generated based on birth date and gender. Before registering a user with an SA ID, please remove the user from olympus admin panel.</p>
            </div>
            <div class="form-section">
                <div class="form-group">
                    <label for="id_idNumber">Identity Number</label>
                    <div class="form-group-with-copy">
                        <input type="text" id="id_idNumber" value="" placeholder="9901160965083" maxlength="13" readonly>
                        <button class="copy-btn" onclick="copyToClipboard('id_idNumber', event)">Copy</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="id_surname">First name</label>
                    <input type="text" value="" id="id_surname" placeholder="VUMA" readonly>
                </div>

                <div class="form-group">
                    <label for="id_names">Last name</label>
                    <input type="text" value="" id="id_names" placeholder="THULISILE" readonly>
                </div>

                <div class="form-group">
                    <label for="id_sex">Sex</label>
                    <select id="id_sex" disabled>
                        <option value="F">Female</option>
                        <option value="M">Male</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="id_dateOfBirth">Date of Birth</label>
                    <input type="date" value="" id="id_dateOfBirth" readonly>
                </div>
                
                <div class="form-group">
                    <label for="id_nationality">Nationality</label>
                    <input type="text" id="id_nationality" value="RSA" readonly>
                </div>
                
                <div class="form-group">
                    <label for="id_countryOfBirth">Country of Birth</label>
                    <input type="text" id="id_countryOfBirth" value="RSA">
                </div>
                
                <div class="form-group">
                    <label for="id_status">Status</label>
                    <select id="id_status">
                        <option value="Citizen">Citizen</option>
                        <option value="Permanent Resident">Permanent Resident</option>
                    </select>
                </div>

                <div class="generate-custom-data">
                    <button class="generate-custom-data-btn" onclick="generateSAIDFastRegistration()">Fast Registration</button>
                    <button class="generate-custom-data-btn" onclick="generateSAIDCustomData()">Generate custom data</button>
                </div>
                
                <div class="photo-upload">
                    <label for="id_photo" class="upload-btn">📷 Upload Photo</label>
                    <input type="file" id="id_photo" accept="image/*">
                    <img id="id_preview" class="preview-photo" alt="Preview">
                </div>
            </div>
            
            <button class="generate-btn" id="id-generate-btn" style="display: none;" onclick="generateIDCard()">Generate ID Card</button>
        </div>

        <!-- PASSPORT FORM -->
        <div id="passport-form" class="form-content">
            <div class="form-section">
                <div class="form-group">
                    <label for="pp_number">Passport Number</label>
                    <div class="form-group-with-copy">
                        <input type="text" id="pp_number" placeholder="M00000000" maxlength="9">
                        <button class="copy-btn" onclick="copyToClipboard('pp_number', event)">Copy</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="pp_identity_no">Identity No</label>
                    <div class="form-group-with-copy">
                        <input type="text" id="pp_identity_no" placeholder="8001014999082" maxlength="9">
                        <button class="copy-btn" onclick="copyToClipboard('pp_identity_no', event)">Copy</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="pp_surname">Last name</label>
                    <input type="text" id="pp_surname" placeholder="MANDELA">
                </div>
                
                <div class="form-group">
                    <label for="pp_names">First name</label>
                    <input type="text" id="pp_names" placeholder="NELSON ROLIHLAHLA">
                </div>
                
                <div class="form-group">
                    <label for="pp_nationality">Nationality</label>
                    <input type="text" id="pp_nationality" value="SOUTH AFRICAN">
                </div>
                
                <div class="form-group">
                    <label for="pp_dob">Date of Birth</label>
                    <input type="date" id="pp_dob">
                </div>
                
                <div class="form-group">
                    <label for="pp_pob_code">Place of Birth</label>
                    <input type="text" id="pp_pob_code" placeholder="">
                </div>
                
                <div class="form-group">
                    <label for="pp_sex">Sex</label>
                    <select id="pp_sex">
                        <option value="M">Male</option>
                        <option value="F">Female</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="pp_issue">Date of Issue</label>
                    <input type="date" id="pp_issue">
                </div>
                
                <div class="form-group">
                    <label for="pp_expiry">Date of Expiry</label>
                    <input type="date" id="pp_expiry">
                </div>
                
                <div class="form-group">
                    <label for="pp_authority">Issuing Authority</label>
                    <input type="text" id="pp_authority" value="DEPT OF HOME AFFAIRS">
                </div>

                <div class="form-group">
                    <label for="pp_country_code">Country code</label>
                    <input type="text" id="pp_country_code" value="">
                </div>

                <div class="generate-custom-data">
                    <button class="generate-custom-data-btn" onclick="generatePassportFastRegistration()">Fast Registration</button>
                    <button class="generate-custom-data-btn" onclick="generatePassportCustomData()">Generate custom data</button>
                </div>
                
                <div class="photo-upload">
                    <label for="pp_photo" class="upload-btn">📷 Upload Photo</label>
                    <input type="file" id="pp_photo" accept="image/*">
                    <img id="pp_preview" class="preview-photo" alt="Preview">
                </div>
            </div>
            
            <button class="generate-btn" id="passport-generate-btn" style="display: none;" onclick="generatePassport()">Generate Passport</button>
        </div>

        <!-- ASYLUM PAPER FORM -->
        <div id="asylum-form" class="form-content">
            <div class="form-section">
                <div class="form-group">
                    <label for="as_refNumber">Reference Number</label>
                    <div class="form-group-with-copy">
                        <input type="text" id="as_refNumber" placeholder="ASY/2024/00000">
                        <button class="copy-btn" onclick="copyToClipboard('as_refNumber', event)">Copy</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="as_surname">Surname</label>
                    <input type="text" id="as_surname" placeholder="SURNAME">
                </div>
                
                <div class="form-group">
                    <label for="as_names">First name</label>
                    <input type="text" id="as_names" placeholder="First name">
                </div>
                
                <div class="form-group">
                    <label for="as_nationality">Nationality</label>
                    <input type="text" id="as_nationality" placeholder="NATIONALITY">
                </div>
                
                <div class="form-group">
                    <label for="as_dob">Date of Birth</label>
                    <input type="date" id="as_dob">
                </div>
                
                <div class="form-group">
                    <label for="as_pob">Place of Birth</label>
                    <input type="text" id="as_pob" placeholder="PLACE OF BIRTH">
                </div>
                
                <div class="form-group">
                    <label for="as_sex">Sex</label>
                    <select id="as_sex">
                        <option value="M">Male</option>
                        <option value="F">Female</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="as_passportNo">Passport Number (if any)</label>
                    <input type="text" id="as_passportNo" placeholder="Optional">
                </div>
                
                <div class="form-group">
                    <label for="as_dateOfArrival">Date of Arrival in SA</label>
                    <input type="date" id="as_dateOfArrival">
                </div>
                
                <div class="form-group">
                    <label for="as_portOfEntry">Port of Entry</label>
                    <input type="text" id="as_portOfEntry" placeholder="e.g., OR Tambo International">
                </div>
                
                <div class="form-group">
                    <label for="as_address">Current Address in SA</label>
                    <textarea id="as_address" placeholder="Full address"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="as_issueDate">Date of Issue</label>
                    <input type="date" id="as_issueDate">
                </div>
                
                <div class="form-group">
                    <label for="as_validUntil">Valid Until</label>
                    <input type="date" id="as_validUntil">
                </div>

                <div class="generate-custom-data">
                    <button class="generate-custom-data-btn" onclick="generateAsylumCustomData()">Generate custom data</button>
                </div>
                
                <div class="photo-upload">
                    <label for="as_photo" class="upload-btn">📷 Upload Photo</label>
                    <input type="file" id="as_photo" accept="image/*">
                    <img id="as_preview" class="preview-photo" alt="Preview">
                </div>
            </div>
            
            <button class="generate-btn" id="asylum-generate-btn" style="display: none;" onclick="generateAsylum()">Generate Asylum Paper</button>
        </div>

        <!-- ID CARD OUTPUT -->
        <div id="id-output" class="document-container">
            <button class="download-btn" id="id-download-btn" style="display: none;" onclick="downloadDocument('id-card', 'SA_ID_Card')">Скачать ID Card</button>
            <div class="id-card" id="id-card">
                <div class="id-card-header">
                    <div class="coat-of-arms">SA Coat of Arms</div>
                    <div class="header-text">
                        <h2>REPUBLIC OF SOUTH AFRICA</h2>
                        <p>IDENTITY DOCUMENT / IDENTITEITSDOKUMENT</p>
                    </div>
                    <div class="coat-of-arms"></div>
                </div>
                
                <div class="id-card-body">
                    <div class="photo-section">
                        <div class="id-photo">
                            <img id="id_cardPhoto" src="" alt="ID Photo">
                        </div>
                    </div>
                    
                    <div class="info-section">
                        <div class="info-row">
                            <div class="info-label">IDENTITY NUMBER / IDENTITEITSNOMMER</div>
                            <div class="info-value id-number" id="id_cardIdNumber">-</div>
                        </div>
                        
                        <div class="info-row">
                            <div class="info-label">SURNAME / VAN</div>
                            <div class="info-value" id="id_cardSurname">-</div>
                        </div>
                        
                        <div class="info-row">
                            <div class="info-label">NAMES / NAME</div>
                            <div class="info-value" id="id_cardNames">-</div>
                        </div>
                        
                        <div style="display: flex; gap: 20px;">
                            <div class="info-row" style="flex: 1;">
                                <div class="info-label">SEX / GESLAG</div>
                                <div class="info-value" id="id_cardSex">-</div>
                            </div>
                            
                            <div class="info-row" style="flex: 1;">
                                <div class="info-label">DATE OF BIRTH / GEBOORTEDATUM</div>
                                <div class="info-value" id="id_cardDob">-</div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 20px;">
                            <div class="info-row" style="flex: 1;">
                                <div class="info-label">COUNTRY OF BIRTH / GEBOORTELAND</div>
                                <div class="info-value" id="id_cardCountry">-</div>
                            </div>
                            
                            <div class="info-row" style="flex: 1;">
                                <div class="info-label">STATUS</div>
                                <div class="info-value" id="id_cardStatus">-</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="id-card-footer">
                    <span>NATIONALITY: <strong id="id_cardNationality">RSA</strong></span>
                    <span>ISSUED: <strong id="id_issueDate">-</strong></span>
                </div>
            </div>
        </div>

        <!-- PASSPORT OUTPUT -->
        <div id="passport-output" class="document-container">
            <button class="download-btn" id="passport-download-btn" style="display: none;" onclick="downloadDocument('passport', 'SA_Passport')">Скачать Passport</button>
            <div class="passport" id="passport">
                <div class="passport-cover">
                    <div class="passport-coat">SA Coat of Arms</div>
                    <div class="passport-title">SOUTH AFRICA</div>
                    <div class="passport-subtitle">SUID-AFRIKA</div>
                    <div class="passport-type">PASSPORT</div>
                </div>
                
                <div class="passport-data-page">
                    <div class="passport-header-section">
                        <h3>REPUBLIC OF SOUTH AFRICA</h3>
                        <p>PASSPORT / PASPOORT</p>
                    </div>

                    <div class="mrz-section" id="pp_mrz">
                        P&lt;ZAFMANDELA&lt;&lt;NELSON&lt;ROLIHLAHLA&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;<br>
                        A000000000ZAF8001015M2512315&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;00
                    </div>
                    
                    <div class="passport-content">
                        <div class="passport-photo-section">
                            <div class="passport-photo">
                                <img id="pp_cardPhoto" src="" alt="Passport Photo">
                            </div>
                        </div>
                        
                        <div class="passport-info">
                            <div class="passport-field">
                                <div class="passport-field-label">Type / Tipe</div>
                                <div class="passport-field-value">P</div>
                            </div>
                            
                            <div class="passport-field">
                                <div class="passport-field-label">Passport No. / Paspoort Nr.</div>
                                <div class="passport-field-value passport-number" id="pp_cardNumber">-</div>
                            </div>

                            <div class="passport-field">
                                <div class="passport-field-label">Country Code / Landkode</div>
                                <div class="passport-field-value" id="pp_cardCountry">-</div>
                            </div>

                            <div class="passport-field">
                                <div class="passport-field-label">Identity No. / Identiteit Nr.</div>
                                <div class="passport-field-value" id="pp_cardIdentityNo">-</div>
                            </div>
                            
                            <div class="passport-field">
                                <div class="passport-field-label">Surname / Van</div>
                                <div class="passport-field-value" id="pp_cardSurname">-</div>
                            </div>
                            
                            <div class="passport-field">
                                <div class="passport-field-label">Given Names / Voornaine</div>
                                <div class="passport-field-value" id="pp_cardNames">-</div>
                            </div>
                            
                            <div class="passport-field">
                                <div class="passport-field-label">Nationality / Nasionaliteit</div>
                                <div class="passport-field-value" id="pp_cardNationality">-</div>
                            </div>
                            
                            <div style="display: flex; gap: 15px;">
                                <div class="passport-field" style="flex: 1;">
                                    <div class="passport-field-label">Date of Birth / Geboortedatum</div>
                                    <div class="passport-field-value" id="pp_cardDob">-</div>
                                </div>
                                
                                <div class="passport-field" style="flex: 1;">
                                    <div class="passport-field-label">Sex / Geslag</div>
                                    <div class="passport-field-value" id="pp_cardSex">-</div>
                                </div>
                            </div>
                            
                            <div class="passport-field">
                                <div class="passport-field-label">Place of Birth / Geboorteplek</div>
                                <div class="passport-field-value" id="pp_cardPob">-</div>
                            </div>
                            
                            <div style="display: flex; gap: 15px;">
                                <div class="passport-field" style="flex: 1;">
                                    <div class="passport-field-label">Date of Issue / Datum van Uitreiking</div>
                                    <div class="passport-field-value" id="pp_cardIssue">-</div>
                                </div>
                                
                                <div class="passport-field" style="flex: 1;">
                                    <div class="passport-field-label">Date of Expiry / Vervaldatum</div>
                                    <div class="passport-field-value" id="pp_cardExpiry">-</div>
                                </div>
                            </div>
                            
                            <div class="passport-field">
                                <div class="passport-field-label">Authority / Gesag</div>
                                <div class="passport-field-value" id="pp_cardAuthority">-</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ASYLUM PAPER OUTPUT -->
        <div id="asylum-output" class="document-container">
            <button class="download-btn" id="asylum-download-btn" style="display: none;" onclick="downloadDocument('asylum-paper', 'SA_Asylum_Paper')">Скачать Asylum Paper</button>
            <div class="asylum-paper" id="asylum-paper">
                <div class="asylum-header">
                    <div class="asylum-logo">REPUBLIC OF SOUTH AFRICA</div>
                    <h2>DEPARTMENT OF HOME AFFAIRS</h2>
                    <h3>ASYLUM SEEKER PERMIT</h3>
                    <p>Section 22 - Refugees Act, 1998 (Act No. 130 of 1998)</p>
                </div>
                
                <div class="asylum-ref">
                    Reference Number: <span id="as_cardRef">-</span>
                </div>
                
                <div class="asylum-content">
                    <div class="asylum-photo-section">
                        <div class="asylum-photo">
                            <img id="as_cardPhoto" src="" alt="Asylum Photo">
                        </div>
                    </div>
                    
                    <div class="asylum-info">
                        <div class="asylum-section">
                            <h4>Personal Information</h4>
                            
                            <div class="asylum-field">
                                <div class="asylum-field-label">Surname</div>
                                <div class="asylum-field-value" id="as_cardSurname">-</div>
                            </div>
                            
                            <div class="asylum-field">
                                <div class="asylum-field-label">First name(s)</div>
                                <div class="asylum-field-value" id="as_cardNames">-</div>
                            </div>
                            
                            <div class="asylum-field">
                                <div class="asylum-field-label">Date of Birth</div>
                                <div class="asylum-field-value" id="as_cardDob">-</div>
                            </div>
                            
                            <div class="asylum-field">
                                <div class="asylum-field-label">Place of Birth</div>
                                <div class="asylum-field-value" id="as_cardPob">-</div>
                            </div>
                            
                            <div class="asylum-field">
                                <div class="asylum-field-label">Sex</div>
                                <div class="asylum-field-value" id="as_cardSex">-</div>
                            </div>
                            
                            <div class="asylum-field">
                                <div class="asylum-field-label">Nationality</div>
                                <div class="asylum-field-value" id="as_cardNationality">-</div>
                            </div>
                            
                            <div class="asylum-field">
                                <div class="asylum-field-label">Passport Number</div>
                                <div class="asylum-field-value" id="as_cardPassportNo">-</div>
                            </div>
                        </div>
                        
                        <div class="asylum-section">
                            <h4>Arrival Information</h4>
                            
                            <div class="asylum-field">
                                <div class="asylum-field-label">Date of Arrival in South Africa</div>
                                <div class="asylum-field-value" id="as_cardArrival">-</div>
                            </div>
                            
                            <div class="asylum-field">
                                <div class="asylum-field-label">Port of Entry</div>
                                <div class="asylum-field-value" id="as_cardPort">-</div>
                            </div>
                            
                            <div class="asylum-field">
                                <div class="asylum-field-label">Current Address in South Africa</div>
                                <div class="asylum-field-value" id="as_cardAddress">-</div>
                            </div>
                        </div>
                        
                        <div class="asylum-section">
                            <h4>Permit Validity</h4>
                            
                            <div style="display: flex; gap: 15px;">
                                <div class="asylum-field" style="flex: 1;">
                                    <div class="asylum-field-label">Date of Issue</div>
                                    <div class="asylum-field-value" id="as_cardIssue">-</div>
                                </div>
                                
                                <div class="asylum-field" style="flex: 1;">
                                    <div class="asylum-field-label">Valid Until</div>
                                    <div class="asylum-field-value" id="as_cardValid">-</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="asylum-footer">
                    <div class="asylum-signature">
                        <div class="asylum-signature-line"></div>
                        <small>Signature of Holder</small>
                    </div>
                    
                    <div class="asylum-signature">
                        <div class="asylum-signature-line"></div>
                        <small>Authorized Officer</small>
                    </div>
                </div>
                
                <div class="asylum-notice">
                    <h4>⚠️ IMPORTANT NOTICE</h4>
                    <p>This permit is issued in terms of Section 22 of the Refugees Act, 1998. The holder is permitted to sojourn in the Republic of South Africa for the period specified above, pending the finalization of their asylum application. This permit does not confer permanent residence rights. The holder must report to the Refugee Reception Office as required and must not engage in any activity prohibited by law.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let idPhotoData = null;
        let passportPhotoData = null;
        let asylumPhotoData = null;

        const photoFemaleFiles = ['face_01.png', 'face_02.png', 'face_03.png'];
        const photoMaleFiles = ['face_04.png', 'face_05.png', 'face_06.png', 'face_07.png'];

        const sexes = ['M', 'F'];
        const nationalities = ['Zulu', 'Xhosa', 'Sotho', 'Tswana', 'Coloureds', 'Whites'];

        const maleFirstNames = [
            'James', 'John', 'Michael', 'David', 'William', 'Robert', 'Joseph', 'Charles',
            'Thomas', 'Daniel', 'Matthew', 'Christopher', 'Andrew', 'Ryan', 'Alexander',
            'Liam', 'Noah', 'Oliver', 'Ethan', 'Lucas', 'Mason', 'Logan', 'Benjamin',
            'Sebastian', 'Jack', 'Henry', 'Owen', 'Samuel', 'Leo', 'Nathan', 'Gabriel'
        ];

        const femaleFirstNames = [
            'Mary', 'Emma', 'Olivia', 'Ava', 'Isabella', 'Sophia', 'Mia', 'Charlotte',
            'Amelia', 'Harper', 'Evelyn', 'Abigail', 'Emily', 'Elizabeth', 'Sofia',
            'Avery', 'Ella', 'Scarlett', 'Grace', 'Chloe', 'Victoria', 'Riley', 'Aria',
            'Lily', 'Aubrey', 'Zoey', 'Penelope', 'Hannah', 'Layla', 'Nora', 'Madison'
        ];

        const lastNames = [
            'Smith', 'Johnson', 'Williams', 'Brown', 'Jones', 'Garcia', 'Miller', 'Davis',
            'Rodriguez', 'Martinez', 'Hernandez', 'Lopez', 'Gonzalez', 'Wilson', 'Anderson',
            'Thomas', 'Taylor', 'Moore', 'Jackson', 'Martin', 'Lee', 'Thompson', 'White',
            'Harris', 'Clark', 'Lewis', 'Robinson', 'Walker', 'Young', 'Hall', 'Allen',
            'King', 'Wright', 'Scott', 'Green', 'Baker', 'Adams', 'Nelson', 'Carter',
            'Mitchell', 'Roberts', 'Turner', 'Phillips', 'Campbell', 'Parker', 'Evans',
            'Edwards', 'Collins', 'Stewart', 'Morris', 'Murphy', 'Cook', 'Rogers', 'Morgan',
            'Peterson', 'Cooper', 'Reed', 'Bailey', 'Bell', 'Gomez', 'Kelly', 'Howard'
        ];

        const countries = [
            { name: 'United States', iso2: 'US', iso3: 'USA', phone: '+1', flag: '🇺🇸' },
            { name: 'United Kingdom', iso2: 'GB', iso3: 'GBR', phone: '+44', flag: '🇬🇧' },
            { name: 'Canada', iso2: 'CA', iso3: 'CAN', phone: '+1', flag: '🇨🇦' },
            { name: 'Australia', iso2: 'AU', iso3: 'AUS', phone: '+61', flag: '🇦🇺' },
            { name: 'Germany', iso2: 'DE', iso3: 'DEU', phone: '+49', flag: '🇩🇪' },
            { name: 'France', iso2: 'FR', iso3: 'FRA', phone: '+33', flag: '🇫🇷' },
            { name: 'Italy', iso2: 'IT', iso3: 'ITA', phone: '+39', flag: '🇮🇹' },
            { name: 'Spain', iso2: 'ES', iso3: 'ESP', phone: '+34', flag: '🇪🇸' },
            { name: 'Japan', iso2: 'JP', iso3: 'JPN', phone: '+81', flag: '🇯🇵' },
            { name: 'China', iso2: 'CN', iso3: 'CHN', phone: '+86', flag: '🇨🇳' },
            { name: 'India', iso2: 'IN', iso3: 'IND', phone: '+91', flag: '🇮🇳' },
            { name: 'Brazil', iso2: 'BR', iso3: 'BRA', phone: '+55', flag: '🇧🇷' },
            { name: 'Mexico', iso2: 'MX', iso3: 'MEX', phone: '+52', flag: '🇲🇽' },
            { name: 'South Africa', iso2: 'ZA', iso3: 'ZAF', phone: '+27', flag: '🇿🇦' },
            { name: 'Nigeria', iso2: 'NG', iso3: 'NGA', phone: '+234', flag: '🇳🇬' },
            { name: 'Egypt', iso2: 'EG', iso3: 'EGY', phone: '+20', flag: '🇪🇬' },
            { name: 'Russia', iso2: 'RU', iso3: 'RUS', phone: '+7', flag: '🇷🇺' },
            { name: 'South Korea', iso2: 'KR', iso3: 'KOR', phone: '+82', flag: '🇰🇷' },
            { name: 'Netherlands', iso2: 'NL', iso3: 'NLD', phone: '+31', flag: '🇳🇱' },
            { name: 'Switzerland', iso2: 'CH', iso3: 'CHE', phone: '+41', flag: '🇨🇭' },
            { name: 'Sweden', iso2: 'SE', iso3: 'SWE', phone: '+46', flag: '🇸🇪' },
            { name: 'Norway', iso2: 'NO', iso3: 'NOR', phone: '+47', flag: '🇳🇴' },
            { name: 'Denmark', iso2: 'DK', iso3: 'DNK', phone: '+45', flag: '🇩🇰' },
            { name: 'Austria', iso2: 'AT', iso3: 'AUT', phone: '+43', flag: '🇦🇹' },
            { name: 'Belgium', iso2: 'BE', iso3: 'BEL', phone: '+32', flag: '🇧🇪' },
            { name: 'Poland', iso2: 'PL', iso3: 'POL', phone: '+48', flag: '🇵🇱' },
            { name: 'Portugal', iso2: 'PT', iso3: 'PRT', phone: '+351', flag: '🇵🇹' },
            { name: 'Greece', iso2: 'GR', iso3: 'GRC', phone: '+30', flag: '🇬🇷' },
            { name: 'Turkey', iso2: 'TR', iso3: 'TUR', phone: '+90', flag: '🇹🇷' },
            { name: 'Argentina', iso2: 'AR', iso3: 'ARG', phone: '+54', flag: '🇦🇷' },
            { name: 'Chile', iso2: 'CL', iso3: 'CHL', phone: '+56', flag: '🇨🇱' },
            { name: 'Colombia', iso2: 'CO', iso3: 'COL', phone: '+57', flag: '🇨🇴' },
            { name: 'Peru', iso2: 'PE', iso3: 'PER', phone: '+51', flag: '🇵🇪' },
            { name: 'Thailand', iso2: 'TH', iso3: 'THA', phone: '+66', flag: '🇹🇭' },
            { name: 'Vietnam', iso2: 'VN', iso3: 'VNM', phone: '+84', flag: '🇻🇳' },
            { name: 'Indonesia', iso2: 'ID', iso3: 'IDN', phone: '+62', flag: '🇮🇩' },
            { name: 'Malaysia', iso2: 'MY', iso3: 'MYS', phone: '+60', flag: '🇲🇾' },
            { name: 'Singapore', iso2: 'SG', iso3: 'SGP', phone: '+65', flag: '🇸🇬' },
            { name: 'Philippines', iso2: 'PH', iso3: 'PHL', phone: '+63', flag: '🇵🇭' },
            { name: 'New Zealand', iso2: 'NZ', iso3: 'NZL', phone: '+64', flag: '🇳🇿' },
            { name: 'Ireland', iso2: 'IE', iso3: 'IRL', phone: '+353', flag: '🇮🇪' },
            { name: 'Finland', iso2: 'FI', iso3: 'FIN', phone: '+358', flag: '🇫🇮' },
            { name: 'Czech Republic', iso2: 'CZ', iso3: 'CZE', phone: '+420', flag: '🇨🇿' },
            { name: 'Israel', iso2: 'IL', iso3: 'ISR', phone: '+972', flag: '🇮🇱' },
            { name: 'Saudi Arabia', iso2: 'SA', iso3: 'SAU', phone: '+966', flag: '🇸🇦' },
            { name: 'United Arab Emirates', iso2: 'AE', iso3: 'ARE', phone: '+971', flag: '🇦🇪' },
            { name: 'Pakistan', iso2: 'PK', iso3: 'PAK', phone: '+92', flag: '🇵🇰' },
            { name: 'Bangladesh', iso2: 'BD', iso3: 'BGD', phone: '+880', flag: '🇧🇩' },
            { name: 'Kenya', iso2: 'KE', iso3: 'KEN', phone: '+254', flag: '🇰🇪' },
            { name: 'Morocco', iso2: 'MA', iso3: 'MAR', phone: '+212', flag: '🇲🇦' }
        ];

        const statuses = ['Citizen', 'Permanent Resident'];

        function getRandomItem(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        // Copy to clipboard function
        function copyToClipboard(inputId, event) {
            const input = document.getElementById(inputId);
            const value = input.value;

            if (!value) {
                alert('No value to copy');
                return;
            }

            const button = event.target;
            const originalText = button.textContent;

            // Modern approach using Clipboard API
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(value).then(function() {
                    // Show success feedback
                    button.textContent = 'Copied!';
                    button.style.background = '#1e7e34';

                    setTimeout(function() {
                        button.textContent = originalText;
                        button.style.background = '#28a745';
                    }, 2000);
                }).catch(function(err) {
                    console.error('Failed to copy: ', err);
                    fallbackCopyTextToClipboard(value, button, originalText);
                });
            } else {
                // Fallback for older browsers
                fallbackCopyTextToClipboard(value, button, originalText);
            }
        }

        // Fallback copy function for older browsers
        function fallbackCopyTextToClipboard(text, button, originalText) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.top = '0';
            textArea.style.left = '0';
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            textArea.style.padding = '0';
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            textArea.style.background = 'transparent';

            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    button.textContent = 'Copied!';
                    button.style.background = '#1e7e34';

                    setTimeout(function() {
                        button.textContent = originalText;
                        button.style.background = '#28a745';
                    }, 2000);
                } else {
                    alert('Failed to copy');
                }
            } catch (err) {
                alert('Failed to copy: ' + err);
            }

            document.body.removeChild(textArea);
        }

        function generateNameByGender(gender) {
            const firstNameList = gender === 'M' ? maleFirstNames : femaleFirstNames;
            return getRandomItem(firstNameList);
        }

        function generateSurname() {
            return getRandomItem(lastNames);
        }

        function getRandomItem(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function generateBirthday() {
            // Generate for ages 16-80
            return generateBirthdayAge(16, 80);
        }

        function generateBirthdayAge(minAge, maxAge) {
            const today = new Date();
            
            // Calculate date range
            const maxDate = new Date(today);
            maxDate.setFullYear(today.getFullYear() - minAge);
            
            const minDate = new Date(today);
            minDate.setFullYear(today.getFullYear() - maxAge - 1);
            
            // Generate random timestamp between min and max
            const randomTime = minDate.getTime() + Math.random() * (maxDate.getTime() - minDate.getTime());
            const birthday = new Date(randomTime);
            
            // Calculate exact age
            const age = calculateAge(birthday, today);

            const day = birthday.getDate();
            const month = birthday.getMonth();
            const year = birthday.getFullYear();

            return `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        }

        function generateFutureDay(minYear, maxYear) {
            const today = new Date();
            
            // Calculate date range
            const maxDate = new Date(today);
            maxDate.setFullYear(today.getFullYear() + minYear);
            
            const minDate = new Date(today);
            minDate.setFullYear(today.getFullYear() + maxYear);
            
            // Generate random timestamp between min and max
            const randomTime = minDate.getTime() + Math.random() * (maxDate.getTime() - minDate.getTime());
            const birthday = new Date(randomTime);
            
            // Calculate exact age
            const age = calculateAge(birthday, today);

            const day = birthday.getDate();
            const month = birthday.getMonth();
            const year = birthday.getFullYear();

            return `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        }

        function calculateAge(birthDate, currentDate) {
            let age = currentDate.getFullYear() - birthDate.getFullYear();
            const monthDiff = currentDate.getMonth() - birthDate.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && currentDate.getDate() < birthDate.getDate())) {
                age--;
            }
            
            return age;
        }

        function generateAddress() {
            const streets = ['123 Main St', '456 Oak Ave'];
            const apartments = ['Apt 4B', '', 'Unit 7'];
            const cities = ['Springfield', 'Greenville'];
            const zips = ['62704', '12345'];
            const countries = ['USA', 'Canada'];

            const addresses = [];

            const maxLength = Math.max(streets.length, apartments.length, cities.length, zips.length, countries.length);

            const parts = [
                streets[Math.floor(Math.random() * maxLength)] || '',
                apartments[Math.floor(Math.random() * maxLength)] || '',
                cities[Math.floor(Math.random() * maxLength)] || '',
                zips[Math.floor(Math.random() * maxLength)] || '',
                countries[Math.floor(Math.random() * maxLength)] || ''
            ].filter(Boolean); // Remove empty strings

            return parts.join(', ');
        }

        async function fillPhoto(gender, identifier) {
            const photoFiles = gender === 'M' ? photoMaleFiles : photoFemaleFiles;
            const photoFile = getRandomItem(photoFiles);
            const blob = await fetch(photoFile).then(res => res.blob());
            const reader = new FileReader();
            reader.onload = function(event) {
                if (identifier === 'id_preview') {
                    idPhotoData = event.target.result;
                    document.getElementById('id_preview').src = idPhotoData;
                    document.getElementById('id_preview').style.display = 'block';
                } else if (identifier === 'pp_preview') {
                    passportPhotoData = event.target.result;
                    document.getElementById('pp_preview').src = passportPhotoData;
                    document.getElementById('pp_preview').style.display = 'block';
                } else if (identifier === 'as_preview') {
                    asylumPhotoData = event.target.result;
                    document.getElementById('as_preview').src = asylumPhotoData;
                    document.getElementById('as_preview').style.display = 'block';
                }
            };
            reader.readAsDataURL(blob);
        }

        function generateRandomString(length) {
            const characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
            let result = "";
            for (let i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return result;
        }

        // Luhn algorithm for checksum calculation
        function calculateLuhnChecksum(idWithoutChecksum) {
            const digits = idWithoutChecksum.split('').map(Number);
            let sum = 0;

            // Process from right to left, doubling every second digit
            for (let i = digits.length - 1; i >= 0; i--) {
                let digit = digits[i];

                // Double every second digit (from right, so odd positions in reversed array)
                if ((digits.length - 1 - i) % 2 === 0) {
                    digit *= 2;
                    if (digit > 9) {
                        digit -= 9; // Equivalent to adding the digits (e.g., 16 -> 1+6=7)
                    }
                }

                sum += digit;
            }

            // The checksum digit is what we need to add to make sum divisible by 10
            const checksum = (10 - (sum % 10)) % 10;
            return checksum;
        }

        // Generate South African ID Number following YYMMDDGSSSCAZ format
        function generateSAIDNumber(dateOfBirth, gender, citizenship = '0') {
            // Parse date of birth
            const dob = new Date(dateOfBirth);
            const yy = dob.getFullYear().toString().slice(-2); // Last 2 digits of year
            const mm = String(dob.getMonth() + 1).padStart(2, '0');
            const dd = String(dob.getDate()).padStart(2, '0');

            // YYMMDD
            let idNumber = yy + mm + dd;

            // GSSS - Gender sequence number
            // Female: 0000-4999, Male: 5000-9999
            let sequenceNumber;
            if (gender === 'F') {
                sequenceNumber = Math.floor(Math.random() * 5000); // 0-4999
            } else {
                sequenceNumber = Math.floor(Math.random() * 5000) + 5000; // 5000-9999
            }
            idNumber += String(sequenceNumber).padStart(4, '0');

            // C - Citizenship (0 = SA citizen, 1 = permanent resident)
            idNumber += citizenship;

            // A - Usually 8 (formerly race, now typically 8)
            idNumber += '8';

            // Z - Checksum using Luhn algorithm
            const checksum = calculateLuhnChecksum(idNumber);
            idNumber += checksum;

            return idNumber;
        }

        function calculateCheckDigit(data) {
            const weights = [7, 3, 1];
            let sum = 0;
            for (let i = 0; i < data.length; i++) {
                let char = data[i];
                let value;
                if (char === '<') {
                    value = 0;
                } else if (char >= '0' && char <= '9') {
                    value = parseInt(char);
                } else if (char >= 'A' && char <= 'Z') {
                    value = char.charCodeAt(0) - 'A'.charCodeAt(0) + 10;
                } else {
                    // Handle other characters if necessary
                    value = 0;
                }
                sum += value * weights[i % 3];
            }
            return sum % 10;
        }

        function formatDateForMRZ(dateString) {
            const date = new Date(dateString);
            const yy = date.getFullYear().toString().slice(2); // Get last two digits of the year
            const mm = String(date.getMonth() + 1).padStart(2, '0'); // Month is zero-based, so we add 1
            const dd = String(date.getDate()).padStart(2, '0'); // Ensure two-digit day

            return `${yy}${mm}${dd}`;
        }

        function generateTD3MRZ(
            documentType, issuingCountry, surname, givenNames,
            documentNumber, pobCode, dateOfBirth, sex, expiryDate,
            identityNo
        ) {
            // Line 1
            let line1 = documentType + issuingCountry;
            let namePart = surname.toUpperCase() + '<<' + givenNames.toUpperCase();
            line1 += namePart.padEnd(39, '<'); // Total 44 chars for line 1
            // Line 2
            const formattedDateOfBirth = formatDateForMRZ(dateOfBirth);
            const formattedExpiryDate = formatDateForMRZ(expiryDate);
            let line2 = documentNumber;
            line2 += calculateCheckDigit(documentNumber);
            line2 += pobCode;
            line2 += formattedDateOfBirth; // YYMMDD
            line2 += calculateCheckDigit(formattedDateOfBirth);
            line2 += sex;
            line2 += formattedExpiryDate; // YYMMDD
            line2 += calculateCheckDigit(formattedExpiryDate);
            line2 += identityNo.padEnd(14, '<'); // Optional field and padding
            
            // Calculate composite check digit for line 2 (example - this is a simplified representation)
            let compositeData = documentNumber + calculateCheckDigit(documentNumber) +
                                dateOfBirth + calculateCheckDigit(dateOfBirth) +
                                expiryDate + calculateCheckDigit(expiryDate) +
                                identityNo.padEnd(14, '<');
            line2 += calculateCheckDigit(compositeData); // Final check digit for line 2

            return line1 + '\n' + line2;
        }

        async function generateSAIDFastRegistration() {
            // Pre-filled data for fast registration
            const surname = 'VUMA';
            const names = 'THULISILE';
            const gender = 'F';
            const dateOfBirth = '1999-01-16';
            const countryOfBirth = 'RSA';
            const status = 'Citizen';
            const nationality = 'RSA';

            // Generate valid SA ID number
            const idNumber = generateSAIDNumber(dateOfBirth, gender, '0'); // 0 = citizen

            // Fill form fields
            document.getElementById('id_idNumber').value = idNumber;
            document.getElementById('id_surname').value = surname;
            document.getElementById('id_names').value = names;
            document.getElementById('id_sex').value = gender;
            document.getElementById('id_dateOfBirth').value = dateOfBirth;
            document.getElementById('id_nationality').value = nationality;
            document.getElementById('id_countryOfBirth').value = countryOfBirth;
            document.getElementById('id_status').value = status;

            // Load photo
            await fillPhoto(gender, 'id_preview');

            // Show generate button
            document.getElementById('id-generate-btn').style.display = 'block';
        }

        async function generateSAIDCustomData() {
            const gender = 'F';

            fillPhoto(gender, 'id_preview');
            document.getElementById('id_nationality').value = getRandomItem(nationalities);
            document.getElementById('id_countryOfBirth').value = getRandomItem(countries).iso3;

            // Show generate button
            document.getElementById('id-generate-btn').style.display = 'block';
        }

        async function generatePassportFastRegistration() {
            // Pre-filled data matching SA ID Fast Registration
            const surname = 'VUMA';
            const names = 'THULISILE';
            const gender = 'F';
            const dateOfBirth = '1999-01-16';
            const nationality = 'SOUTH AFRICAN';
            const pob_code = 'ZAF';
            const authority = 'DEPT OF HOME AFFAIRS';
            const countryCode = 'ZAF';

            // Generate SA ID number
            const identityNo = generateSAIDNumber(dateOfBirth, gender, '0');

            // Generate passport number (M + 8 random digits)
            const number = 'M' + Math.floor(Math.random() * 100000000).toString().padStart(8, '0');

            // Generate dates
            const today = new Date();
            const issueDate = new Date(today.getFullYear() - 1, today.getMonth(), today.getDate());
            const expiryDate = new Date(today.getFullYear() + 9, today.getMonth(), today.getDate());

            const issue = issueDate.toISOString().split('T')[0];
            const expiry = expiryDate.toISOString().split('T')[0];

            // Fill form
            document.getElementById('pp_number').value = number;
            document.getElementById('pp_identity_no').value = identityNo;
            document.getElementById('pp_surname').value = surname;
            document.getElementById('pp_names').value = names;
            document.getElementById('pp_nationality').value = nationality;
            document.getElementById('pp_dob').value = dateOfBirth;
            document.getElementById('pp_pob_code').value = pob_code;
            document.getElementById('pp_sex').value = gender;
            document.getElementById('pp_issue').value = issue;
            document.getElementById('pp_expiry').value = expiry;
            document.getElementById('pp_authority').value = authority;
            document.getElementById('pp_country_code').value = countryCode;

            await fillPhoto(gender, 'pp_preview');

            // Show generate button
            document.getElementById('passport-generate-btn').style.display = 'block';
        }

        async function generatePassportCustomData() {
            const gender = getRandomItem(sexes);
            const number = 'M' + Math.floor(Math.random() * 100000000).toString().padStart(8, '0');
            const identityNo = Math.floor(Math.random() * 10000000000000).toString().padStart(13, '0');
            const surname = generateSurname();
            const names = generateNameByGender(gender);
            const nationality = getRandomItem(nationalities);
            const dob = generateBirthday();
            const pob_code = getRandomItem(countries).iso3;
            const sex = gender;
            const issue = generateFutureDay(1, 5);
            const expiry = generateFutureDay(1, 5);
            const authority = 'DEPT OF HOME AFFAIRS';
            const countryCode = getRandomItem(countries).iso3;
            document.getElementById('pp_number').value = number;
            document.getElementById('pp_identity_no').value = identityNo;
            document.getElementById('pp_surname').value = surname;
            document.getElementById('pp_names').value = names;
            document.getElementById('pp_nationality').value = nationality;
            document.getElementById('pp_dob').value = dob;
            document.getElementById('pp_pob_code').value = pob_code;
            document.getElementById('pp_sex').value = sex;
            document.getElementById('pp_issue').value = issue;
            document.getElementById('pp_expiry').value = expiry;
            document.getElementById('pp_authority').value = authority;
            document.getElementById('pp_country_code').value = countryCode;

            fillPhoto(gender, 'pp_preview');

            // Show generate button
            document.getElementById('passport-generate-btn').style.display = 'block';
        }

        async function generateAsylumCustomData() {
            const gender = getRandomItem(sexes);
            const randomNumber = Math.floor(Math.random() * 100000).toString().padStart(5, '0');
            document.getElementById('as_refNumber').value = `ASY2024${randomNumber}`;
            document.getElementById('as_surname').value = generateSurname();
            document.getElementById('as_names').value = generateNameByGender(gender);
            document.getElementById('as_nationality').value = getRandomItem(nationalities);
            document.getElementById('as_dob').value = generateBirthday();
            document.getElementById('as_pob').value = getRandomItem(countries).name;
            document.getElementById('as_sex').value = gender;
            document.getElementById('as_passportNo').value = Math.floor(Math.random() * 100000).toString().padStart(10, '0');
            document.getElementById('as_dateOfArrival').value = generateBirthdayAge(0, 16);;
            document.getElementById('as_portOfEntry').value = getRandomItem(countries).name;
            document.getElementById('as_address').value = generateAddress();
            document.getElementById('as_issueDate').value = generateFutureDay(1, 5);
            document.getElementById('as_validUntil').value = generateFutureDay(1, 5);

            fillPhoto(gender, 'as_preview');

            // Show generate button
            document.getElementById('asylum-generate-btn').style.display = 'block';
        }

        // Tab switching
        function switchTab(tab) {
            const tabs = document.querySelectorAll('.tab');
            const forms = document.querySelectorAll('.form-content');
            const outputs = document.querySelectorAll('.document-container');

            tabs.forEach(t => t.classList.remove('active'));
            forms.forEach(f => f.classList.remove('active'));
            outputs.forEach(o => o.style.display = 'none');

            if (tab === 'id') {
                tabs[0].classList.add('active');
                document.getElementById('id-form').classList.add('active');
                // Show only ID output if it was generated
                const idOutput = document.getElementById('id-output');
                if (idOutput.querySelector('#id-card .id-photo img').src) {
                    idOutput.style.display = 'block';
                }
            } else if (tab === 'passport') {
                tabs[1].classList.add('active');
                document.getElementById('passport-form').classList.add('active');
                // Show only Passport output if it was generated
                const ppOutput = document.getElementById('passport-output');
                if (ppOutput.querySelector('.passport-photo img').src) {
                    ppOutput.style.display = 'block';
                }
            } else if (tab === 'asylum') {
                tabs[2].classList.add('active');
                document.getElementById('asylum-form').classList.add('active');
                // Show only Asylum output if it was generated
                const asOutput = document.getElementById('asylum-output');
                if (asOutput.querySelector('.asylum-photo img').src) {
                    asOutput.style.display = 'block';
                }
            }
        }

        // Photo uploads
        document.getElementById('id_photo').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    idPhotoData = event.target.result;
                    document.getElementById('id_preview').src = idPhotoData;
                    document.getElementById('id_preview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('pp_photo').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    passportPhotoData = event.target.result;
                    document.getElementById('pp_preview').src = passportPhotoData;
                    document.getElementById('pp_preview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('as_photo').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    asylumPhotoData = event.target.result;
                    document.getElementById('as_preview').src = asylumPhotoData;
                    document.getElementById('as_preview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });

        // Generate ID Card
        function generateIDCard() {
            const idNumber = document.getElementById('id_idNumber').value;
            const surname = document.getElementById('id_surname').value;
            const names = document.getElementById('id_names').value;
            const sex = document.getElementById('id_sex').value;
            const dob = document.getElementById('id_dateOfBirth').value;
            const nationality = document.getElementById('id_nationality').value;
            const country = document.getElementById('id_countryOfBirth').value;
            const status = document.getElementById('id_status').value;

            console.log(idNumber, surname, names, sex, dob, nationality, country, status);

            if (!idNumber || !surname || !names || !dob) {
                alert('Please fill in all required fields');
                return;
            }

            if (!idPhotoData) {
                alert('Please upload a photo');
                return;
            }

            document.getElementById('id_cardIdNumber').textContent = idNumber;
            document.getElementById('id_cardSurname').textContent = surname.toUpperCase();
            document.getElementById('id_cardNames').textContent = names.toUpperCase();
            document.getElementById('id_cardSex').textContent = sex;
            document.getElementById('id_cardDob').textContent = new Date(dob).toLocaleDateString('en-ZA');
            document.getElementById('id_cardNationality').textContent = nationality;
            document.getElementById('id_cardCountry').textContent = country;
            document.getElementById('id_cardStatus').textContent = status;
            document.getElementById('id_cardPhoto').src = idPhotoData;
            document.getElementById('id_issueDate').textContent = new Date().toLocaleDateString('en-ZA');

            document.getElementById('id-output').style.display = 'block';
            document.getElementById('id-download-btn').style.display = 'block';
            document.getElementById('id-output').scrollIntoView({ behavior: 'smooth' });
        }

        // Generate Passport
        function generatePassport() {
            const number = document.getElementById('pp_number').value;
            const identityNo = document.getElementById('pp_identity_no').value;
            const surname = document.getElementById('pp_surname').value;
            const names = document.getElementById('pp_names').value;
            const nationality = document.getElementById('pp_nationality').value;
            const dob = document.getElementById('pp_dob').value;
            const pob_code = document.getElementById('pp_pob_code').value;
            const sex = document.getElementById('pp_sex').value;
            const issue = document.getElementById('pp_issue').value;
            const expiry = document.getElementById('pp_expiry').value;
            const authority = document.getElementById('pp_authority').value;
            const countryCode = document.getElementById('pp_country_code').value;

            if (!number || !surname || !names || !dob || !issue || !expiry) {
                alert('Please fill in all required fields');
                return;
            }

            if (!passportPhotoData) {
                alert('Please upload a photo');
                return;
            }

            document.getElementById('pp_cardNumber').textContent = number;
            document.getElementById('pp_cardSurname').textContent = surname.toUpperCase();
            document.getElementById('pp_cardNames').textContent = names.toUpperCase();
            document.getElementById('pp_cardNationality').textContent = nationality.toUpperCase();
            document.getElementById('pp_cardDob').textContent = new Date(dob).toLocaleDateString('en-GB');
            document.getElementById('pp_cardPob').textContent = pob_code.toUpperCase();
            document.getElementById('pp_cardSex').textContent = sex;
            document.getElementById('pp_cardIssue').textContent = new Date(issue).toLocaleDateString('en-GB');
            document.getElementById('pp_cardExpiry').textContent = new Date(expiry).toLocaleDateString('en-GB');
            document.getElementById('pp_cardAuthority').textContent = authority.toUpperCase();
            document.getElementById('pp_cardPhoto').src = passportPhotoData;
            document.getElementById('pp_cardCountry').textContent = countryCode.toUpperCase();
            document.getElementById('pp_cardIdentityNo').textContent = identityNo;

            const mrzString = generateTD3MRZ(
                'PM', countryCode, surname, names,
                number, pob_code, dob, sex, expiry, identityNo,
            );
            console.log(mrzString);
            document.getElementById('pp_mrz').textContent = mrzString;

            document.getElementById('passport-output').style.display = 'block';
            document.getElementById('passport-download-btn').style.display = 'block';
            document.getElementById('passport-output').scrollIntoView({ behavior: 'smooth' });
        }

        // Generate Asylum Paper
        function generateAsylum() {
            const refNumber = document.getElementById('as_refNumber').value;
            const surname = document.getElementById('as_surname').value;
            const names = document.getElementById('as_names').value;
            const nationality = document.getElementById('as_nationality').value;
            const dob = document.getElementById('as_dob').value;
            const pob = document.getElementById('as_pob').value;
            const sex = document.getElementById('as_sex').value;
            const passportNo = document.getElementById('as_passportNo').value;
            const arrival = document.getElementById('as_dateOfArrival').value;
            const port = document.getElementById('as_portOfEntry').value;
            const address = document.getElementById('as_address').value;
            const issueDate = document.getElementById('as_issueDate').value;
            const validUntil = document.getElementById('as_validUntil').value;

            if (!refNumber || !surname || !names || !nationality || !dob || !arrival || !issueDate || !validUntil) {
                alert('Please fill in all required fields');
                return;
            }

            if (!asylumPhotoData) {
                alert('Please upload a photo');
                return;
            }

            document.getElementById('as_cardRef').textContent = refNumber;
            document.getElementById('as_cardSurname').textContent = surname.toUpperCase();
            document.getElementById('as_cardNames').textContent = names.toUpperCase();
            document.getElementById('as_cardNationality').textContent = nationality.toUpperCase();
            document.getElementById('as_cardDob').textContent = new Date(dob).toLocaleDateString('en-ZA');
            document.getElementById('as_cardPob').textContent = pob.toUpperCase();
            document.getElementById('as_cardSex').textContent = sex;
            document.getElementById('as_cardPassportNo').textContent = passportNo || 'N/A';
            document.getElementById('as_cardArrival').textContent = new Date(arrival).toLocaleDateString('en-ZA');
            document.getElementById('as_cardPort').textContent = port.toUpperCase();
            document.getElementById('as_cardAddress').textContent = address;
            document.getElementById('as_cardIssue').textContent = new Date(issueDate).toLocaleDateString('en-ZA');
            document.getElementById('as_cardValid').textContent = new Date(validUntil).toLocaleDateString('en-ZA');
            document.getElementById('as_cardPhoto').src = asylumPhotoData;

            document.getElementById('asylum-output').style.display = 'block';
            document.getElementById('asylum-download-btn').style.display = 'block';
            document.getElementById('asylum-output').scrollIntoView({ behavior: 'smooth' });
        }

        // Download document as image
        function downloadDocument(elementId, filename) {
            const element = document.getElementById(elementId);
            if (!element) {
                alert('Документ не найден. Пожалуйста, сначала сгенерируйте документ.');
                return;
            }

            // Generate unique filename with timestamp
            const timestamp = new Date().getTime();
            const uniqueFilename = `${filename}_${timestamp}`;

            // Use html2canvas library to convert HTML element to image
            // First, we need to load the library if not already loaded
            if (typeof html2canvas === 'undefined') {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
                script.onload = function() {
                    captureAndDownload(element, uniqueFilename);
                };
                document.head.appendChild(script);
            } else {
                captureAndDownload(element, uniqueFilename);
            }
        }

        function captureAndDownload(element, filename) {
            // Get the original element's class to determine document type and size
            let targetWidth, targetHeight;

            if (element.classList.contains('id-card')) {
                targetWidth = 856;
                targetHeight = 540;
            } else if (element.classList.contains('passport')) {
                targetWidth = 1000;
                targetHeight = 1400;
            } else if (element.classList.contains('asylum-paper')) {
                targetWidth = 800;
                targetHeight = 'auto'; // Will calculate based on content
            }

            // Clone the element
            const clone = element.cloneNode(true);

            // Create a temporary container positioned off-screen
            const tempContainer = document.createElement('div');
            tempContainer.style.cssText = `
                position: fixed;
                left: -99999px;
                top: 0;
                width: ${targetWidth}px;
                overflow: visible;
                z-index: -1;
            `;

            // Force clone to full size with NO transforms
            clone.style.cssText = `
                transform: none !important;
                transform-origin: initial !important;
                width: ${targetWidth}px !important;
                height: ${targetHeight === 'auto' ? 'auto' : targetHeight + 'px'} !important;
                max-width: none !important;
                max-height: none !important;
                min-width: ${targetWidth}px !important;
                min-height: ${targetHeight === 'auto' ? 'auto' : targetHeight + 'px'} !important;
                margin: 0 !important;
                padding: 0 !important;
                position: relative !important;
                display: block !important;
            `;

            // Append to temp container and then to body
            tempContainer.appendChild(clone);
            document.body.appendChild(tempContainer);

            // Wait for rendering and fonts to load
            setTimeout(function() {
                const actualHeight = targetHeight === 'auto' ? clone.offsetHeight : targetHeight;

                html2canvas(clone, {
                    scale: 3,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: null,
                    logging: false,
                    width: targetWidth,
                    height: actualHeight,
                    windowWidth: targetWidth,
                    windowHeight: actualHeight
                }).then(function(canvas) {
                    // Remove temp container
                    document.body.removeChild(tempContainer);

                    // Convert canvas to blob
                    canvas.toBlob(function(blob) {
                        // Create download link
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = filename + '.png';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                    });
                }).catch(function(error) {
                    // Remove temp container on error
                    if (document.body.contains(tempContainer)) {
                        document.body.removeChild(tempContainer);
                    }
                    console.error('Error capturing document:', error);
                    alert('Ошибка при создании изображения. Попробуйте еще раз.');
                });
            }, 300);
        }
    </script>
</body>
</html>